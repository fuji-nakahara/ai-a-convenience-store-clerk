sudo: false

language: ruby

env:
  global:
    - JEKYLL_ENV=production
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true

cache: bundler

script:
  - bundle exec jekyll build
  - bundle exec htmlproofer ./_site --disable-external --url-swap '\A\/ai-a-convenience-store-clerk:'
  - bundle exec jekyll build-ebook --kindle

deploy:
  - provider: pages
    github-token: # Run `travis encrypt YOUR_TOKEN`
    skip-cleanup: true
    local-dir: _site
    target_branch: gh-pages
    on:
      branch: master
  - provider: releases
    api_key:
      secure: # Run `travis encrypt YOUR_TOKEN`
    skip_cleanup: true
    file:
      - _ebook/ai-a-convenience-store-clerk.epub
      - _ebook/ai-a-convenience-store-clerk.mobi
    on:
      tags: true
